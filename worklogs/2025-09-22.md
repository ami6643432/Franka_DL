# 2025-09-22 Worklog

## Progress
- Added reward shaping for reliable grasp: gating by proximity/alignment, contact-style bonus, straddle checks, gap reward, and logging for W&B.
- Tuned Panda hand PD (lower stiffness/higher damping) for smoother closure; ensured finger controls remain position-based.
- Instrumented grasp diagnostics (pos_err components, finger projections) and console logs to debug alignment issues.
- Integrated straddle requirement/bonus to enforce both fingers wrapping the handle before opening reward kicks in.
- Confirmed the single MAPPO agent acts as a position planner (actions â†’ joint position targets).
- Added default configuration stub for `CustomOperationalSpaceController` and instantiate it in the environment (not yet wired into actuation).
- Hooked controller into the environment loop: arm joints now have zero stiffness implicit actuators, controller tracks planner's arm targets, applies torques via `set_joint_effort_target`, while fingers remain position-controlled.

## Planned
- Convert arm joints to explicit effort actuators and wire in `CustomOperationalSpaceController` to track planner's joint targets while leaving fingers on PD.
- Keep policy unchanged; the controller will translate planned positions into torques.
- After integration, evaluate existing checkpoints; retune controller gains or gripper PD if necessary.
- Enabled optional debug logging in the controller (config flag + interval) and switched controller gains to per-joint lists to begin manual tuning (default values chosen as starting point).
- Tuned controller defaults: reduced per-joint Kp/Kd, reintroduced small passive stiffness/damping on arm joints, and clamped torques via `controller_torque_limit`.
- Added a `use_torque_controller` flag to toggle between explicit torque control (via OSC) and direct position servoing; ARM finger commands now branch accordingly.
